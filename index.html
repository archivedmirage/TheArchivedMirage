<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>The Archived Mirage</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<style>
/* ---- SAME CSS, UNCHANGED ---- */
:root{
--bg:#f6f6f7;
--card:#ffffff;
--text:#202223;
--border:#e1e3e5;
--primary:#008060;
--glass:rgba(255,255,255,.55);
}
body.dark{
--bg:#0e0f11;
--card:#16181c;
--text:#eaeaea;
--border:#2a2d33;
--glass:rgba(20,20,25,.55);
}
*{box-sizing:border-box}
body{
margin:0;
font-family:Inter,system-ui;
background:var(--bg);
color:var(--text);
overflow-x:hidden;
transition:.3s;
}
h1,h2,h3,strong{font-family:"Playfair Display",serif}
/* ---- rest of your CSS stays identical ---- */
</style>
</head>

<body>

<!-- ---- HTML UNCHANGED ---- -->

<script>
const productsEl=document.getElementById("products");
const cartDrawer=document.getElementById("cartDrawer");
const cartOverlay=document.getElementById("cartOverlay");
const cartCount=document.getElementById("cartCount");
const contactPhone=document.getElementById("contactPhone");
const contactEmail=document.getElementById("contactEmail");
const admin=document.getElementById("admin");
const loginOverlay=document.getElementById("loginOverlay");

const ADMIN_PASSWORD="samariboys@buisness2026";

let isAdminLoggedIn=false;

let theme=localStorage.getItem("theme")||"light";
document.body.classList.toggle("dark",theme==="dark");

let contact=JSON.parse(localStorage.getItem("contact"))||
{phone:"+971543108125",email:"nuaimshariff@gmail.com"};

let products=JSON.parse(localStorage.getItem("products"))||[
{id:1,name:"Product One",price:100,stock:5,image:"https://via.placeholder.com/400"},
{id:2,name:"Product Two",price:150,stock:3,image:"https://via.placeholder.com/400"}
];

let cart=[];
let orders=JSON.parse(localStorage.getItem("orders"))||[];
let current="home";

function save(){
localStorage.setItem("products",JSON.stringify(products));
localStorage.setItem("orders",JSON.stringify(orders));
localStorage.setItem("contact",JSON.stringify(contact));
}

/* ---------- FIXED STOCK PERSISTENCE ---------- */

function renderProducts(){
productsEl.innerHTML="";
products.forEach(p=>{
productsEl.innerHTML+=`
<div class="product">
<img src="${p.image}">
<div class="info">
<strong>${p.name}</strong><br>
${p.price} AED<br>
<small>Stock: ${p.stock}</small>
<button onclick="addToCart(${p.id})">Add to Cart</button>
</div></div>`;
});
}

function addToCart(id){
const p=products.find(x=>x.id===id);
if(!p||p.stock<=0)return alert("Out of stock");

let item=cart.find(i=>i.id===id);
item?item.qty++:cart.push({...p,qty:1});

p.stock--;          // reduce stock
save();             // ✅ SAVE CHANGE
renderProducts();
renderCart();
}

function changeQty(i,v){
const item=cart[i];
const product=products.find(p=>p.id===item.id);

item.qty+=v;
product.stock-=v;

if(item.qty<=0){
product.stock+=item.qty;
cart.splice(i,1);
}

save();             // ✅ SAVE CHANGE
renderProducts();
renderCart();
}

/* ---------- CART ---------- */

function renderCart(){
cartDrawer.innerHTML="<h3>Your Cart</h3>";
let total=0;
cart.forEach((i,idx)=>{
total+=i.price*i.qty;
cartDrawer.innerHTML+=`
<div><strong>${i.name}</strong>
<div class="qty">
<button onclick="changeQty(${idx},-1)">−</button>
${i.qty}
<button onclick="changeQty(${idx},1)">+</button>
</div></div><hr>`;
});
cartDrawer.innerHTML+=`
<strong>Total: ${total} AED</strong><br><br>
<button onclick="go('checkout')">Checkout</button>`;
cartCount.innerText=cart.reduce((a,b)=>a+b.qty,0);
}

/* ---------- ADMIN ---------- */

function renderAdmin(){
go("admin");
admin.innerHTML=`
<h2>Admin Panel</h2><hr>

<h3>Products</h3>
${products.map((p,i)=>`
<div class="admin-box">
<input value="${p.name}" onchange="products[${i}].name=this.value;save();renderProducts()">
<input type="number" value="${p.price}" onchange="products[${i}].price=+this.value;save();renderProducts()">
<input type="number" value="${p.stock}" onchange="products[${i}].stock=+this.value;save();renderProducts()">
<input value="${p.image}" onchange="products[${i}].image=this.value;save();renderProducts()">
<button onclick="deleteProduct(${i})">Delete</button>
</div>`).join("")}

<button onclick="addProduct()">Add Product</button>
`;
}

function addProduct(){
products.push({
id:Date.now(),
name:"New Product",
price:0,
stock:0,
image:"https://via.placeholder.com/400"
});
save();
renderAdmin();
renderProducts();
}

function deleteProduct(i){
if(!confirm("Delete product?"))return;
products.splice(i,1);
save();
renderAdmin();
renderProducts();
}

/* ---------- INIT ---------- */

renderProducts();
renderCart();
contactPhone.innerText=contact.phone;
contactEmail.innerText=contact.email;

</script>

</body>
</html>
