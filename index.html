<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>The Archived Mirage</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;600&family=UnifrakturMaguntia&display=swap" rel="stylesheet">

<style>
/* THEME VARIABLES */
:root {
    --bg: #f6f6f7;
    --card: #ffffff;
    --text: #202223;
    --border: #e1e3e5;
    --primary: #000000;
    --accent: #8e8e8e;
}

body.dark {
    --bg: #0e0f11;
    --card: #16181c;
    --text: #eaeaea;
    --border: #2a2d33;
    --primary: #ffffff;
    --accent: #666666;
}

* { box-sizing: border-box; }
body { margin: 0; font-family: Inter, sans-serif; background: var(--bg); color: var(--text); overflow-x: hidden; transition: background 0.4s, color 0.4s; min-height: 100vh; }
.brand-font { font-family: 'UnifrakturMaguntia', cursive; }

/* LUXURY INTRO - Z-INDEX FIXED */
#intro {
    position: fixed; inset: 0; background: #000; z-index: 10000;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    color: white; pointer-events: none; opacity: 1; transition: 1s ease;
}
body.loaded #intro { opacity: 0; visibility: hidden; }
#intro .line { width: 1px; height: 80px; background: white; margin-bottom: 20px; }

/* HEADER & THEME SLIDER */
header { background: var(--card); border-bottom: 1px solid var(--border); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 500; }
.nav-right { display: flex; align-items: center; gap: 20px; }
nav a { cursor: pointer; font-weight: 600; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; text-decoration: none; color: inherit; }

/* THEME SLIDER */
.theme-switch { position: relative; width: 50px; height: 24px; }
.theme-switch input { opacity: 0; width: 0; height: 0; }
.slider { position: absolute; cursor: pointer; inset: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
.slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
input:checked + .slider { background-color: #333; }
input:checked + .slider:before { transform: translateX(26px); }

/* SECTION SYSTEM */
main { position: relative; width: 100vw; }
section {
    display: none; padding: 25px; 
    background: var(--bg); 
    min-height: calc(100vh - 70px);
}
section.active { display: block; position: relative; z-index: 10; }

/* CATEGORY FILTERS & SEARCH */
.filter-bar { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
.search-container { max-width: 400px; margin: 0 auto 30px; }
.filter-btn { background: transparent; border: 1px solid var(--border); color: var(--text); padding: 8px 16px; cursor: pointer; font-size: 0.7rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; transition: 0.3s; }
.filter-btn.active { background: var(--primary); color: var(--bg); }

/* PRODUCT STOCK STYLING */
.product { background: var(--card); border: 1px solid var(--border); position: relative; display: flex; flex-direction: column; }
.product img { width: 100%; height: 350px; object-fit: cover; }
.out-of-stock-label { position: absolute; top: 0; left: 0; width: 100%; height: 350px; background: rgba(0,0,0,0.6); color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem; letter-spacing: 2px; pointer-events: none; z-index: 2; }

/* CART & CHECKOUT UI */
#cartDrawer { position: fixed; top: 0; right: -400px; width: 380px; max-width: 100%; height: 100%; background: var(--card); z-index: 2000; transition: 0.4s; display: flex; flex-direction: column; box-shadow: -10px 0 30px rgba(0,0,0,0.2); }
#cartDrawer.open { right: 0; }
.cart-content { flex: 1; overflow-y: auto; padding: 20px; }
.cart-footer { padding: 20px; border-top: 1px solid var(--border); background: var(--card); }
.checkout-btn { background: var(--primary); color: var(--bg); width: 100%; padding: 18px; font-weight: bold; cursor: pointer; border: none; font-size: 1rem; border-radius: 4px; }

/* GRID & BOXES */
.grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; max-width: 1200px; margin: auto; }
.info { padding: 15px; text-align: center; }
.admin-box { background: var(--card); border: 1px solid var(--border); padding: 20px; border-radius: 8px; margin-bottom: 15px; color: var(--text); }
input, textarea, select { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid var(--border); background: #fff; color: #000; border-radius: 4px; }
body.dark input, body.dark textarea, body.dark select { background: #1a1a1a; color: #fff; }
#cartOverlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1500; display: none; backdrop-filter: blur(4px); }

/* STATUS COLORS */
.status-tag { padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; text-transform: uppercase; }
.status-Pending { background: #fff3cd; color: #856404; }
.status-Shipped { background: #cce5ff; color: #004085; }
.status-Delivered { background: #d4edda; color: #155724; }

/* MOBILE RESPONSIVE TWEAKS */
@media (max-width: 768px) {
    .grid { grid-template-columns: 1fr; }
    .contact-grid, .admin-grid { grid-template-columns: 1fr !important; }
    header { padding: 10px; }
    .nav-right { gap: 10px; }
    nav a { font-size: 0.7rem; }
    #home h1 { font-size: 2.5rem !important; }
    #cartDrawer { width: 100%; right: -100%; }
}
</style>
</head>

<body>

<div id="intro">
    <div class="line"></div>
    <h1 class="brand-font" style="font-size: 2.5rem; letter-spacing: 4px;">The Archived Mirage</h1>
    <p style="font-size: 0.7rem; letter-spacing: 3px; margin-top: 10px; opacity: 0.8;">100% REAL & AUTHENTIC</p>
</div>

<header>
    <div class="brand-font" onclick="go('home')" style="cursor:pointer; font-size: 1.2rem;">The Archived Mirage</div>
    <div class="nav-right">
        <label class="theme-switch">
            <input type="checkbox" id="themeToggle" onchange="toggleTheme()">
            <span class="slider"></span>
        </label>
        <nav>
            <a onclick="go('home')">Home</a>
            <a onclick="go('store')">Store</a>
            <a onclick="go('contact')">Contact</a>
            <a onclick="openCart()" style="position:relative; font-size: 1.2rem; cursor:pointer;">ðŸ›’<span id="cartCount" style="background:red; color:white; border-radius:50%; padding:2px 6px; font-size:10px; position:absolute; top:-5px; right:-10px;">0</span></a>
        </nav>
    </div>
</header>

<main>
    <section id="home" class="active">
        <div style="text-align:center; padding-top:15vh;">
            <h1 class="brand-font" style="font-size:4rem; margin:0;">The Archived Mirage</h1>
            <p style="letter-spacing:5px; opacity: 0.7; font-weight: 600;">100% REAL AND AUTHENTIC PRODUCTS</p>
            <button onclick="go('store')" style="background:var(--primary); color:var(--bg); padding:18px 45px; border:none; margin-top:30px; cursor:pointer; font-weight:bold; letter-spacing: 2px; border-radius: 4px;">EXPLORE STORE</button>
        </div>
    </section>

    <section id="store">
        <h2 style="text-align:center; font-family:'Playfair Display'; margin-bottom:20px;">The Collection</h2>
        <div class="search-container">
            <input type="text" id="storeSearch" placeholder="Search products..." oninput="renderStore()" style="border-radius: 30px; padding-left: 20px;">
        </div>
        <div class="filter-bar" id="categoryFilters">
            <button class="filter-btn active" onclick="filterBy('All')">All</button>
        </div>
        <div class="grid" id="products"></div>
    </section>

    <section id="contact">
        <div style="max-width:800px; margin:auto; padding-top: 20px;">
            <h2 class="brand-font" style="font-size:2.5rem; text-align:center;">Contact Us</h2>
            <div class="contact-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-top: 40px;">
                <div>
                    <h3 style="font-family:'Playfair Display';">Get in Touch</h3>
                    <p style="opacity:0.8; line-height:1.6;">Have questions about our archived pieces? Reach out through the form or our direct channels.</p>
                    <div style="margin-top:20px;">
                        <p><strong>WhatsApp:</strong> <span id="displayWA">971543108125</span></p>
                        <p><strong>Email:</strong> <span id="displayEmail">nuaimshariff@gmail.com</span></p>
                        <p><strong>Location:</strong> Dubai, United Arab Emirates</p>
                    </div>
                </div>
                <div class="admin-box">
                    <input id="contactName" placeholder="Your Name">
                    <input id="contactSubject" placeholder="Subject">
                    <textarea id="contactMsg" placeholder="Message" rows="5"></textarea>
                    <button onclick="sendInquiry()" style="background:var(--primary); color:var(--bg); width:100%; padding:15px; border:none; font-weight:bold; cursor:pointer; border-radius: 4px;">SEND MESSAGE</button>
                </div>
            </div>
        </div>
    </section>

    <section id="checkout">
        <div style="max-width:600px; margin:auto;">
            <h2 class="brand-font" style="font-size:2rem; text-align:center;">Secure Checkout</h2>
            <div id="checkSummary" class="admin-box"></div>
            <div class="admin-box">
                <input id="cN" placeholder="Full Name">
                <input id="cP" placeholder="Phone Number">
                <textarea id="cA" placeholder="Delivery Address" rows="4"></textarea>
                <button onclick="placeOrder()" style="background:#25D366; color:white; font-size:1.1rem; padding:15px; width:100%; border:none; font-weight:bold; cursor:pointer; border-radius: 4px;">Place Order</button>
                <button onclick="go('store')" style="background:none; border:none; width:100%; margin-top:10px; cursor:pointer; text-decoration:underline; color:inherit;">Cancel</button>
            </div>
        </div>
    </section>

    <section id="admin">
        <div id="adminAuth" style="max-width:350px; margin:100px auto; text-align:center; position:relative; z-index:1000;">
            <h3 style="letter-spacing:2px;">VAULT ACCESS</h3>
            <input type="password" id="pass" placeholder="Admin Password" style="margin-top:20px;">
            <button id="loginBtn" onclick="checkAdmin()" style="background:var(--primary); color:var(--bg); width:100%; padding:15px; border:none; cursor:pointer; font-weight:bold; border-radius: 4px;">LOGIN TO DASHBOARD</button>
        </div>
        <div id="adminPanel" style="display:none; max-width: 1100px; margin: auto;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h2 class="brand-font">Dashboard</h2>
                <button onclick="location.reload()" style="padding:5px 15px; cursor:pointer; border:1px solid var(--border);">Logout</button>
            </div>
            
            <div class="admin-box" style="background:var(--primary); color:var(--bg); text-align:center;">
                <p style="font-size:0.8rem; margin:0;">TOTAL REVENUE</p>
                <h1 id="revDisplay" style="margin:10px 0;">0 AED</h1>
            </div>

            <div class="admin-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <h3>Active Orders</h3>
                    <div id="admOrders"></div>
                </div>
                <div>
                    <h3>Inventory Management</h3>
                    <div class="admin-box">
                        <input type="text" id="adminSearch" placeholder="ðŸ” Search Inventory..." oninput="renderInventory()" style="margin-bottom:15px;">
                        <div style="display:flex; gap:10px;">
                            <input id="newCatName" placeholder="New category name" style="margin:0;">
                            <button onclick="window.addNewCategoryShortcut()" style="background:var(--primary); color:var(--bg); padding:0 20px; border:none; cursor:pointer; font-weight:bold; border-radius: 4px;">ADD</button>
                        </div>
                    </div>
                    <button onclick="window.addP()" style="background:green; color:white; padding:12px; width:100%; border:none; margin-bottom:20px; cursor:pointer; font-weight:bold; border-radius: 4px;">+ ADD PRODUCT</button>
                    <div id="admProds"></div>
                </div>
            </div>
        </div>
    </section>
</main>

<footer>
    <div style="text-align:center; padding:40px; border-top:1px solid var(--border); font-size:0.7rem; opacity:0.6;">
        <span onclick="go('admin')" style="cursor:pointer">Â©</span> 2026 THE ARCHIVED MIRAGE
    </div>
</footer>

<div id="cartOverlay" onclick="closeCart()"></div>
<div id="cartDrawer">
    <div style="padding: 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items:center;">
        <span class="brand-font" style="font-size:1.5rem;">Bag</span>
        <span onclick="closeCart()" style="cursor:pointer; font-weight:bold;">âœ•</span>
    </div>
    <div class="cart-content" id="cartItemsList"></div>
    <div class="cart-footer">
        <div style="display:flex; justify-content:space-between; margin-bottom:15px; font-weight:bold; font-size:1.2rem;">
            <span>Total</span>
            <span id="cartTotalDisplay">0 AED</span>
        </div>
        <button class="checkout-btn" onclick="goToCheckout()">PROCEED TO CHECKOUT</button>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue, push, remove, update, set, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const conf = {
    apiKey: "AIzaSyDFLAL6I7ID_BY5weBVf6wx99jJXelhCH4",
    authDomain: "the-archived-mirage.firebaseapp.com",
    databaseURL: "https://the-archived-mirage-default-rtdb.firebaseio.com",
    projectId: "the-archived-mirage",
    storageBucket: "the-archived-mirage.firebasestorage.app",
    appId: "1:615352427360:web:dbebc6e1baac1b1742f405"
};

const app = initializeApp(conf);
const db = getDatabase(app);
let prods = [], cart = [], orders = [], settings = {}, curr = "home", activeFilter = "All";

window.addEventListener('load', () => setTimeout(() => document.body.classList.add('loaded'), 1500));

window.go = (id) => {
    document.querySelectorAll('section').forEach(s => s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    curr = id;
    window.closeCart();
    window.scrollTo(0,0);
};

window.toggleTheme = () => document.body.classList.toggle('dark');
window.openCart = () => {
    document.getElementById('cartOverlay').style.display = "block";
    document.getElementById('cartDrawer').classList.add('open');
    renderCart();
};
window.closeCart = () => {
    document.getElementById('cartOverlay').style.display = "none";
    document.getElementById('cartDrawer').classList.remove('open');
};

window.addToCart = (fid) => {
    const p = prods.find(x => x.fid === fid);
    if(p.stock <= 0) return alert("Out of stock!");
    const ex = cart.find(i => i.fid === fid);
    if(ex && ex.qty >= p.stock) return alert("No more stock available");
    ex ? ex.qty++ : cart.push({...p, qty: 1});
    updateCartUI();
    window.openCart();
};

function updateCartUI() {
    document.getElementById('cartCount').innerText = cart.reduce((a,b)=>a+b.qty,0);
}

function renderCart() {
    const list = document.getElementById('cartItemsList');
    if(cart.length === 0) { list.innerHTML = "<p style='text-align:center; margin-top:50px; opacity:0.5;'>Your bag is empty.</p>"; return; }
    let total = cart.reduce((a,b) => a+(b.price*b.qty), 0);
    list.innerHTML = cart.map(i => `
        <div style="margin-bottom:20px; border-bottom:1px solid var(--border); padding-bottom:10px;">
            <div style="display:flex; justify-content:space-between; font-weight:600;">
                <span>${i.name}</span>
                <span>${i.price * i.qty} AED</span>
            </div>
            <div style="font-size:0.8rem; opacity:0.6;">Quantity: ${i.qty}</div>
            <button onclick="removeFromCart('${i.fid}')" style="background:none; border:none; color:red; cursor:pointer; padding:0; font-size:0.7rem;">Remove</button>
        </div>`).join('');
    document.getElementById('cartTotalDisplay').innerText = total + " AED";
}

window.removeFromCart = (fid) => {
    cart = cart.filter(i => i.fid !== fid);
    updateCartUI();
    renderCart();
};

window.goToCheckout = () => {
    if(cart.length === 0) return alert("Bag is empty");
    const total = cart.reduce((a,b) => a+(b.price*b.qty), 0);
    document.getElementById('checkSummary').innerHTML = `
        <h3>Order Summary</h3>
        ${cart.map(i => `<div>${i.name} x ${i.qty}</div>`).join('')}
        <hr>
        <div style="font-weight:bold; font-size:1.2rem; margin-top:10px;">Total: ${total} AED</div>
    `;
    go('checkout');
};

window.placeOrder = async () => {
    const n = document.getElementById('cN').value.trim();
    const p = document.getElementById('cP').value.trim();
    const a = document.getElementById('cA').value.trim();
    if(!n || !p) return alert("Name and Phone are required.");

    const total = cart.reduce((a,b)=>a+(b.price*b.qty),0);
    const orderData = { customer: n, phone: p, address: a, items: cart, total: total, status: 'Pending', date: new Date().toISOString() };

    try {
        await push(ref(db, 'orders'), orderData);
        // Deduct Stock
        for (const item of cart) {
            const currentP = prods.find(x => x.fid === item.fid);
            update(ref(db, `products/${item.fid}`), { stock: Math.max(0, currentP.stock - item.qty) });
        }
        
        const msg = `*New Order:*\nName: ${n}\nTotal: ${total} AED\nItems: ${cart.map(i => i.name).join(', ')}`;
        window.location.href = `https://wa.me/${settings.whatsapp || '971543108125'}?text=${encodeURIComponent(msg)}`;
        
        cart = [];
        updateCartUI();
        alert("Order successful!");
        go('home');
    } catch (e) { alert("Error: " + e.message); }
};

window.checkAdmin = () => {
    if(document.getElementById('pass').value === "samariboys@buisness2026") {
        document.getElementById('adminAuth').style.display="none";
        document.getElementById('adminPanel').style.display="block";
    } else { alert("Wrong password"); }
};

onValue(ref(db, 'products'), (s) => {
    prods = s.val() ? Object.entries(s.val()).map(([id, v]) => ({...v, fid: id})) : [];
    renderStore();
    renderInventory();
});

onValue(ref(db, 'orders'), (s) => {
    orders = s.val() ? Object.entries(s.val()).map(([id, v]) => ({...v, fid: id})) : [];
    const totalRev = orders.reduce((a,b) => a + Number(b.total), 0);
    document.getElementById('revDisplay').innerText = totalRev + " AED";
    
    document.getElementById('admOrders').innerHTML = orders.slice().reverse().map(o => `
        <div class="admin-box" style="border-left: 5px solid black;">
            <div style="display:flex; justify-content:space-between;">
                <strong>${o.customer}</strong>
                <span class="status-tag status-${o.status}">${o.status}</span>
            </div>
            <div style="font-size:0.8rem; margin:5px 0;">${o.phone} | ${o.total} AED</div>
            <select onchange="updateStatus('${o.fid}', this.value)" style="margin-bottom:5px; font-size:0.7rem;">
                <option value="Pending" ${o.status==='Pending'?'selected':''}>Pending</option>
                <option value="Shipped" ${o.status==='Shipped'?'selected':''}>Shipped</option>
                <option value="Delivered" ${o.status==='Delivered'?'selected':''}>Delivered</option>
            </select>
            <button onclick="delO('${o.fid}')" style="background:none; border:none; color:red; cursor:pointer; font-size:0.7rem; float:right;">Delete</button>
        </div>`).join('');
});

window.updateStatus = (id, s) => update(ref(db, `orders/${id}`), {status: s});
window.delO = (id) => confirm("Delete order record?") && remove(ref(db, `orders/${id}`));

window.renderStore = () => {
    const query = document.getElementById('storeSearch').value.toLowerCase();
    const cats = ["All", ...new Set(prods.map(p => p.category).filter(c => c))];
    document.getElementById('categoryFilters').innerHTML = cats.map(c => `<button class="filter-btn ${activeFilter === c ? 'active' : ''}" onclick="filterBy('${c}')">${c}</button>`).join('');

    let filtered = activeFilter === "All" ? prods : prods.filter(p => p.category === activeFilter);
    if(query) filtered = filtered.filter(p => p.name.toLowerCase().includes(query));

    document.getElementById("products").innerHTML = filtered.map(p => `
        <div class="product">
            ${p.stock <= 0 ? '<div class="out-of-stock-label">OUT OF STOCK</div>' : ''}
            <img src="${p.image || 'https://via.placeholder.com/400'}">
            <div class="info">
                <div style="font-size:0.7rem; opacity:0.5; text-transform:uppercase;">${p.category}</div>
                <strong>${p.name}</strong><br>${p.price} AED
                <button onclick="addToCart('${p.fid}')" ${p.stock <= 0 ? 'disabled' : ''} style="background:var(--primary); color:var(--bg); border:none; width:100%; padding:10px; margin-top:10px; cursor:pointer; font-weight:bold; border-radius: 4px;">
                    ${p.stock <= 0 ? 'SOLD OUT' : 'ADD TO BAG'}
                </button>
            </div>
        </div>`).join('');
};

window.filterBy = (cat) => { activeFilter = cat; renderStore(); };

window.renderInventory = () => {
    const query = document.getElementById('adminSearch').value.toLowerCase();
    const filtered = prods.filter(p => p.name.toLowerCase().includes(query));
    document.getElementById('admProds').innerHTML = filtered.map(p => `
        <div class="admin-box">
            <input value="${p.name}" onchange="upP('${p.fid}','name',this.value)" placeholder="Name">
            <input value="${p.image}" onchange="upP('${p.fid}','image',this.value)" placeholder="Image URL">
            <div style="display:flex; gap:10px;">
                <input type="number" value="${p.price}" onchange="upP('${p.fid}','price',this.value)" placeholder="Price">
                <input type="number" value="${p.stock}" onchange="upP('${p.fid}','stock',this.value)" placeholder="Stock">
            </div>
            <input value="${p.category}" onchange="upP('${p.fid}','category',this.value)" placeholder="Category">
            <button onclick="delP('${p.fid}')" style="background:red; color:white; border:none; width:100%; padding:8px; cursor:pointer; border-radius: 4px;">Delete Product</button>
        </div>`).join('');
};

window.addP = () => push(ref(db, 'products'), {name: "New Piece", price: 0, stock: 1, category: "Archive", image: ""});
window.upP = (id, k, v) => update(ref(db, `products/${id}`), {[k]: (k==='price'||k==='stock')?Number(v):v});
window.delP = (id) => confirm("Delete?") && remove(ref(db, `products/${id}`));
window.addNewCategoryShortcut = () => {
    const c = document.getElementById('newCatName').value;
    if(!c) return;
    push(ref(db, 'products'), {name: "Template Item", price: 0, stock: 0, category: c, image: ""});
    document.getElementById('newCatName').value = "";
};

onValue(ref(db, 'settings'), (s) => { settings = s.val() || {whatsapp: "971543108125"}; });
window.sendInquiry = () => {
    const msg = document.getElementById('contactMsg').value;
    window.location.href = `mailto:nuaimshariff@gmail.com?body=${encodeURIComponent(msg)}`;
};
</script>
</body>
</html>
