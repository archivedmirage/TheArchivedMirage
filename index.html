<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>The Archived Mirage</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;600&family=UnifrakturMaguntia&display=swap" rel="stylesheet">
<style>
:root{--bg:#f6f6f7;--card:#ffffff;--text:#202223;--border:#e1e3e5;--primary:#000000;}
body.dark{--bg:#0e0f11;--card:#16181c;--text:#eaeaea;--border:#2a2d33;}
*{box-sizing:border-box; transition: 0.2s;}
body{margin:0;font-family:Inter,sans-serif;background:var(--bg);color:var(--text);overflow-x:hidden;}
.brand-font {font-family: 'UnifrakturMaguntia', cursive; font-size: 1.5rem;}
header{background:var(--card); border-bottom:1px solid var(--border); padding:15px; display:flex; justify-content:space-between; align-items:center; position:sticky; top:0; z-index:100;}
nav a {margin-left:15px; cursor:pointer; font-weight:600; text-decoration:none; color:inherit;}
.badge {background:red; color:white; padding:2px 6px; border-radius:50%; font-size:11px;}
section {display:none; padding:20px; max-width:1200px; margin:auto;}
section.active {display:block;}
.grid {display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:20px;}
.product {background:var(--card); border:1px solid var(--border); border-radius:15px; padding:10px; text-align:center;}
.product img {width:100%; height:200px; object-fit:cover; border-radius:10px;}
button {background:var(--primary); color:white; border:none; padding:10px; border-radius:8px; width:100%; cursor:pointer; margin-top:10px; font-weight:bold;}
input, textarea {width:100%; padding:12px; margin-bottom:10px; border-radius:8px; border:1px solid var(--border); background:var(--card); color:var(--text);}
#cartSidebar {position:fixed; top:0; right:-100%; width:320px; height:100%; background:var(--card); border-left:1px solid var(--border); z-index:200; padding:20px; transition:0.4s;}
#cartSidebar.open {right:0;}
.order-card {border:1px solid var(--border); padding:15px; border-radius:10px; margin-bottom:10px;}
</style>
</head>
<body class="dark">

<header>
    <div class="brand-font" onclick="go('home')" style="cursor:pointer">The Archived Mirage</div>
    <nav>
        <a onclick="go('store')">Store</a>
        <a onclick="adminLogin()">Admin</a>
        <a onclick="toggleCart()">ðŸ›’<span class="badge" id="cartCount">0</span></a>
        <a onclick="toggleTheme()">ðŸŒ“</a>
    </nav>
</header>

<section id="home" class="active">
    <div style="text-align:center; padding:80px 0;">
        <h1 class="brand-font" style="font-size:3.5rem;">The Archived Mirage</h1>
        <p>Premium Authentic Clothing</p>
        <button onclick="go('store')" style="width:200px;">Enter Shop</button>
    </div>
</section>

<section id="store">
    <h2>Shop All</h2>
    <div class="grid" id="productGrid"></div>
</section>

<section id="checkout">
    <h2>Checkout</h2>
    <div id="checkoutSummary"></div>
    <hr>
    <input id="name" placeholder="Name">
    <input id="phone" placeholder="WhatsApp Number">
    <textarea id="address" placeholder="Address"></textarea>
    <button onclick="placeOrder()" style="background:green;">Confirm Order</button>
</section>

<section id="admin">
    <div style="display:flex; gap:10px; margin-bottom:20px;">
        <button onclick="showAdminTab('p')">Products</button>
        <button onclick="showAdminTab('o')">Orders</button>
        <button onclick="location.reload()" style="background:#666">Logout</button>
    </div>
    <div id="adminView"></div>
</section>

<div id="cartSidebar">
    <h3>Your Cart <span onclick="toggleCart()" style="float:right; cursor:pointer;">Ã—</span></h3>
    <div id="cartList"></div>
    <div id="cartTotal" style="margin:20px 0; font-weight:bold;"></div>
    <button onclick="go('checkout')" id="checkoutBtn" style="display:none">Checkout</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, set, onValue, push, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDFLAL6I7ID_BY5weBVf6wx99jJXelhCH4",
  authDomain: "the-archived-mirage.firebaseapp.com",
  databaseURL: "https://the-archived-mirage-default-rtdb.firebaseio.com",
  projectId: "the-archived-mirage",
  storageBucket: "the-archived-mirage.firebasestorage.app",
  messagingSenderId: "615352427360",
  appId: "1:615352427360:web:dbebc6e1baac1b1742f405"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let products = [];
let orders = [];
let cart = [];
let adminMode = false;

// SYNC
onValue(ref(db, 'products'), (s) => {
    const d = s.val();
    products = d ? Object.entries(d).map(([id, v]) => ({...v, id})) : [];
    renderStore();
    if(adminMode) showAdminTab('p');
});

onValue(ref(db, 'orders'), (s) => {
    const d = s.val();
    orders = d ? Object.entries(d).map(([id, v]) => ({...v, id})) : [];
    if(adminMode) showAdminTab('o');
});

// CORE FUNCTIONS
window.go = (id) => {
    document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    if(id === 'checkout') renderCheckout();
    toggleCart(false);
};

window.toggleTheme = () => document.body.classList.toggle('dark');

window.toggleCart = (show) => {
    const s = document.getElementById('cartSidebar');
    show === false ? s.classList.remove('open') : s.classList.toggle('open');
};

function renderStore() {
    document.getElementById('productGrid').innerHTML = products.map(p => `
        <div class="product">
            <img src="${p.image}">
            <h4>${p.name}</h4>
            <p>${p.price} AED</p>
            <button onclick="addToCart('${p.id}')">Add to Cart</button>
        </div>
    `).join('');
}

window.addToCart = (id) => {
    const p = products.find(x => x.id === id);
    const item = cart.find(i => i.id === id);
    item ? item.qty++ : cart.push({...p, qty: 1});
    updateUI();
    toggleCart(true);
};

function updateUI() {
    document.getElementById('cartCount').innerText = cart.reduce((a,b)=>a+b.qty, 0);
    document.getElementById('cartList').innerHTML = cart.map(i=>`<div>${i.name} x${i.qty}</div>`).join('');
    const total = cart.reduce((a,b)=>a+(b.price*b.qty), 0);
    document.getElementById('cartTotal').innerText = total > 0 ? `Total: ${total} AED` : "Empty";
    document.getElementById('checkoutBtn').style.display = total > 0 ? "block" : "none";
}

function renderCheckout() {
    document.getElementById('checkoutSummary').innerHTML = cart.map(i=>`<div>${i.name} (${i.qty})</div>`).join('');
}

window.placeOrder = () => {
    const n = document.getElementById('name').value;
    const p = document.getElementById('phone').value;
    const a = document.getElementById('address').value;
    if(!n || !p || !a) return alert("Fill all fields");

    const order = { name:n, phone:p, addr:a, items:cart, status:'Pending', date: new Date().toLocaleDateString() };
    push(ref(db, 'orders'), order).then(() => {
        window.open(`https://wa.me/971543108125?text=Order From ${n}`);
        cart = []; updateUI(); go('home');
    });
};

window.adminLogin = () => {
    if(prompt("Pass?") === "samariboys@buisness2026") { adminMode = true; go('admin'); showAdminTab('p'); }
};

window.showAdminTab = (tab) => {
    const v = document.getElementById('adminView');
    if(tab === 'p') {
        v.innerHTML = `<button onclick="addP()">+ Add Product</button>` + products.map(p=>`
            <div class="order-card">
                <input value="${p.name}" onchange="upP('${p.id}','name',this.value)">
                <input value="${p.price}" onchange="upP('${p.id}','price',this.value)">
                <button onclick="delP('${p.id}')" style="background:red">Delete</button>
            </div>`).join('');
    } else {
        v.innerHTML = orders.map(o=>`
            <div class="order-card">
                <strong>${o.name} - ${o.status}</strong><br>
                Items: ${o.items.map(i=>i.name).join(', ')}<br>
                <button onclick="upO('${o.id}','Delivered')">Mark Delivered</button>
            </div>`).join('');
    }
};

window.addP = () => push(ref(db, 'products'), {name:"New Item", price:0, image:"https://via.placeholder.com/200"});
window.upP = (id, k, v) => set(ref(db, `products/${id}/${k}`), k==='price'?Number(v):v);
window.delP = (id) => confirm("Del?") && remove(ref(db, `products/${id}`));
window.upO = (id, s) => set(ref(db, `orders/${id}/status`), s);

</script>
</body>
</html>
